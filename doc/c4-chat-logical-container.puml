@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml
!includeurl https://raw.githubusercontent.com/skleanthous/C4-PlantumlSkin/master/build/output/c4.puml
skinparam linetype polyline
skinparam linetype ortho

!define DEVICONS https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/master/devicons
!define FONTAWESOME https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/master/font-awesome-5
!include DEVICONS/angular.puml
!include DEVICONS/java.puml
!include DEVICONS/msql_server.puml
!include FONTAWESOME/users.puml

LAYOUT_WITH_LEGEND()

Person(clerk, "Clerk", "People that sell product", $sprite="users")
Person(customer, "Customer", "People that need product", $sprite="users")

Container_Ext(keycloak, "Keycloak", "java", "Authenticate user", $sprite="java")

Container_Boundary(chatContainer,chatContainer){
Container(spa, "SPA", "angular", "The main interface that the customer interacts with", $sprite="angular")

Container(gateway, "API Gateway", "java", "Handles all business logic", $sprite="java")
Container(chatapp, "ChatApp", "java", "Main chat application", $sprite="java")
Container(chatInstanceDiscovery, "Chat Instance Discovery", "java", "Chat Instance Discovery", $sprite="java")
Container(chatLoadBalancer, "Chat Load Balancer", "java", "Chat Load Balancer", $sprite="java")
ContainerQueue(chatqueue, "Chat Queue", "java", "Queue to send communication between different instances", $sprite="java")


ContainerDb(db, "Database", "Mongo DB", "Holds chat message history for user", $sprite="msql_server")

}
Rel(clerk, spa, "Uses", "https")
Rel(customer, spa, "Uses", "https")
Rel(spa, gateway, "Uses", "https")
Rel(gateway,keycloak,"Uses", "https")
Rel(gateway,chatLoadBalancer,"Uses", "https")
Rel(chatLoadBalancer,chatInstanceDiscovery,"Uses", "https")
Rel(chatLoadBalancer,chatapp,"Uses", "https")
Rel(chatInstanceDiscovery,chatapp,"Discovery"," ")
Rel_R(chatapp, db, "Reads/Writes")
Rel_R(chatapp,chatqueue,"Readns/Writes")
@enduml